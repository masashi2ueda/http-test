# 概要
- flask+gunicornのスペックをチェックする

# 実行
1. composeを起動
    ```sh
    docker compose up -d
    ```
    - flask+gunicornとuserコンテナが立ち上がる
1. flask+gunicornの起動確認→ホストでhttp://127.0.0.1:5901/goodにアクセスして、Goodとでればok
1. userコンテナに入る
1. flask+gunicornのスペックをuserコンテナの中の以下コマンドで測る
    ```sh
    locust -f locustfile.py --headless -u 1000 -r 100 --run-time 10s
    ```
    - -fはLocustのテストスクリプトのパスを指定
    - --headlessはGUIなしで実行することを指定
    - -uはシミュレートするユーザーの数を指定
    - -rはユーザーの発生率（秒あたり）を指定
    - --run-timeはテストの実行時間を指定


Type     Name                                                                          # reqs      # fails |    Avg     Min     Max    Med |   req/s  failures/s<br>
--------|----------------------------------------------------------------------------|-------|-------------|-------|-------|-------|-------|--------|-----------
GET      /                                                                                365     0(0.00%) |     54       1      86     60 |   37.10        0.00
POST     /                                                                                231     0(0.00%) |     53       1      85     59 |   23.48        0.00
PUT      /1                                                                               157     0(0.00%) |     51       1      84     58 |   15.96        0.00
DELETE   /3                                                                                70     0(0.00%) |     56       1      82     60 |    7.12        0.00
GET      /?age=30                                                                         320     0(0.00%) |     53       1      86     60 |   32.53        0.00
--------|----------------------------------------------------------------------------|-------|-------------|-------|-------|-------|-------|--------|-----------
         Aggregated                                                                      1143     0(0.00%) |     53       1      86     60 |  116.19        0.00

Response time percentiles (approximated)
Type     Name                                                                                  50%    66%    75%    80%    90%    95%    98%    99%  99.9% 99.99%   100% # reqs
--------|--------------------------------------------------------------------------------|--------|------|------|------|------|------|------|------|------|------|------|------
GET      /                                                                                      60     62     65     68     77     81     83     85     86     86     86    365
POST     /                                                                                      59     62     64     66     75     79     82     84     85     85     85    231
PUT      /1                                                                                     58     61     63     65     76     81     82     84     85     85     85    157
DELETE   /3                                                                                     61     62     64     65     75     80     82     83     83     83     83     70
GET      /?age=30                                                                               60     62     64     65     74     78     82     82     86     86     86    320
--------|--------------------------------------------------------------------------------|--------|------|------|------|------|------|------|------|------|------|------|------
         Aggregated                                                                             60     62     64     66     75     80     82     84     86     86     86   1143


# 参考
- [【Docker × Flask】Locustでflask製のREST APIに負荷をかけてみる](https://scrawledtechblog.com/docker-flask-locust/)
