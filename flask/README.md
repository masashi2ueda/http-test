# 概要
- flaskのdev serverのスペックをチェックする

# 実行
1. composeを起動
    ```sh
    docker compose up -d
    ```
    - flaskとuserコンテナが立ち上がる
1. flaskの起動確認→ホストでhttp://127.0.0.1:5901/goodにアクセスして、Goodとでればok
1. userコンテナに入る
1. flaskのdevserverのスペックをuserコンテナの中の以下コマンドで測る
    ```sh
    locust -f locustfile.py --headless -u 1000 -r 100 --run-time 10s
    ```
    - -fはLocustのテストスクリプトのパスを指定
    - --headlessはGUIなしで実行することを指定
    - -uはシミュレートするユーザーの数を指定
    - -rはユーザーの発生率（秒あたり）を指定
    - --run-timeはテストの実行時間を指定


Type     Name                                                                          # reqs      # fails |    Avg     Min     Max    Med |   req/s  failures/s
--------|----------------------------------------------------------------------------|-------|-------------|-------|-------|-------|-------|--------|-----------
GET      /                                                                                361     0(0.00%) |     86       1     169     91 |   36.96        0.00
POST     /                                                                                247     0(0.00%) |     85       1     164     88 |   25.29        0.00
PUT      /1                                                                               150     0(0.00%) |     84       2     160     90 |   15.36        0.00
DELETE   /3                                                                                75     0(0.00%) |     89       2     145     89 |    7.68        0.00
GET      /?age=30                                                                         298     0(0.00%) |     85       2     171     89 |   30.51        0.00
--------|----------------------------------------------------------------------------|-------|-------------|-------|-------|-------|-------|--------|-----------
         Aggregated                                                                      1131     0(0.00%) |     86       1     171     90 |  115.79        0.00

Response time percentiles (approximated)
Type     Name                                                                                  50%    66%    75%    80%    90%    95%    98%    99%  99.9% 99.99%   100% # reqs
--------|--------------------------------------------------------------------------------|--------|------|------|------|------|------|------|------|------|------|------|------
GET      /                                                                                      91    110    110    120    130    140    150    160    170    170    170    361
POST     /                                                                                      88    110    110    120    130    130    150    150    160    160    160    247
PUT      /1                                                                                     90    110    120    120    130    140    150    150    160    160    160    150
DELETE   /3                                                                                     89    110    120    120    130    140    140    150    150    150    150     75
GET      /?age=30                                                                               91    100    110    120    130    140    150    160    170    170    170    298
--------|--------------------------------------------------------------------------------|--------|------|------|------|------|------|------|------|------|------|------|------
         Aggregated                                                                             90    110    110    120    130    140    150    160    170    170    170   1131

# 参考
- [【Docker × Flask】Locustでflask製のREST APIに負荷をかけてみる](https://scrawledtechblog.com/docker-flask-locust/)
